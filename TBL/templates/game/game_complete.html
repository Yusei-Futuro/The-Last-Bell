{% extends "game/base_game.html" %}
{% load static %}

{% block content %}

<section class="h-100 gradient-form" style="background-image: url('{% static "maininicial.jpg" %}');
                    background-size: cover;
                    background-position: center;
                    background-repeat: no-repeat;
                    min-height: 100vh;
                    width: 100%;
">
<div class="game-complete text-center" style="margin-top: 42px">
    <h1>¡Juego Completado!</h1>
    <p class="lead">Has completado los 7 días en el colegio</p>

    <div class="results mt-5">
        <h2>Total de Amigos Conseguidos: {{ friends_count }}/7</h2>

        <div class="relationships mt-4">
            <h3>Relaciones:</h3>
            <div class="row">
                {% for relationship in relationships %}
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <img src="{% static relationship.character.image_url %}" class="card-img-top" alt="{{ relationship.character.name }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ relationship.character.name }}</h5>
                            <p class="card-text">
                                {% if relationship.is_friend %}
                                    ✅ ¡Son amigos!
                                {% else %}
                                    ❌ No son amigos aún
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <a href="{% url 'main_game' %}" class="btn btn-primary btn-lg mt-5">
        Volver al Menú
    </a>
</div>
<audio id="audio" loop preload="auto">
    <source src="{% static sounds/mix-audio.MP3 %}" type="audio/mpeg">
    </audio>

    <script>
    let savedTime = localStorage.getItem("musicTime");
    const audio = document.getElementById("audio");
    audio.addEventListener("loadedmetadata", () => {
        if (savedTime) {
            audio.currentTime = parseFloat(savedTime);
        }
        audio.play();
    });

    setInterval(() => {
        localStorage.setItem("musicTime", audio.currentTime);
    }, 500);
    </script>
</section>
{% endblock %}